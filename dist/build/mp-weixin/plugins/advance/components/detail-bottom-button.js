(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["plugins/advance/components/detail-bottom-button"],{"5c91":function(t,e,n){"use strict";n.r(e);var i=n("c384"),o=n("e6c3");for(var a in o)"default"!==a&&function(t){n.d(e,t,function(){return o[t]})}(a);n("f28a");var r=n("2877"),s=Object(r["a"])(o["default"],i["a"],i["b"],!1,null,"31c765fd",null);e["default"]=s.exports},b0b5:function(t,e,n){},c259:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=o(n("a34a"));function o(t){return t&&t.__esModule?t:{default:t}}function a(t,e,n,i,o,a,r){try{var s=t[a](r),c=s.value}catch(u){return void n(u)}s.done?e(c):Promise.resolve(c).then(i,o)}function r(t){return function(){var e=this,n=arguments;return new Promise(function(i,o){var r=t.apply(e,n);function s(t){a(r,i,o,s,c,"next",t)}function c(t){a(r,i,o,s,c,"throw",t)}s(void 0)})}}function s(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,i)}return n}function c(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?s(n,!0).forEach(function(e){u(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):s(n).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function u(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var d=function(){return n.e("components/page-component/goods/bd-service").then(n.bind(null,"861b"))},l={name:"detail-bottom-button",data:function(){return{request_time:!1,once_pay:!1,webUrl:"",disable:"disable"}},components:{bdService:d},props:{end_prepayment_at:String,active:Boolean,favorite:Boolean,goods_id:Number,detail:Object,num:Number,theme:Object,buttonDisabled:Boolean},created:function(){this.webUrl="/plugins/advance/detail/detail?id="+this.goods_id},methods:{set_active:function(){this.$user.isLogin()&&!this.once_pay?this.$emit("close_attr",!1):this.$user.isLogin()||this.$user.getInfo().then(function(){}).catch(function(){})},set_favorite:function(e){var n=this;e?this.$request({url:this.$api.user.favorite_remove,data:{goods_id:this.goods_id}}).then(function(e){0===e.code?n.$emit("favorite",!n.favorite):t.showModal({title:"提示",content:e.msg})}):this.$request({url:this.$api.user.favorite_add,data:{goods_id:this.goods_id}}).then(function(e){0===e.code?n.$emit("favorite",!n.favorite):t.showModal({title:"提示",content:e.msg})})},route_jump:function(){t.navigateTo({url:"/pages/index/index"})},submit:function(e){var n=this;this.once_pay=!0,t.showLoading({title:"生成订单中...",mask:!0}),this.$emit("close_attr",!0),this.get_submit(e).then(function(t){n.get_token(t.data)})},pay:function(){var e=this;if(!this.buttonDisabled)if(this.detail.min_number>this.num)this.$tips.showToast({title:"该商品"+this.detail.min_number+this.detail.unit+"起售",icon:"none"});else if("undefined"!==typeof this.detail.limit_buy&&1==this.detail.limit_buy.status&&this.detail.limit_buy.rest_number<this.num)this.$tips.showToast({title:this.detail.limit_buy.text,icon:"none"});else{for(var n={goods_id:this.detail.id,goods_attr_id:0,goods_num:"".concat(this.num),advance_goods_id:this.detail.advanceGoods.id},i="",o=this.detail.attr_groups,a=0;a<o.length;a++)for(var r=o[a],s=0;s<r.attr_list.length;s++)r.attr_list[s].active&&(i+=":".concat(r.attr_list[s].attr_id));for(var c=0;c<this.detail.attr.length;c++)if(this.detail.attr[c].sign_id===i.substring(1)){if(this.num>this.detail.attr[c].stock)return void t.showToast({title:"库存不足",icon:"none"});n.goods_attr_id=this.detail.attr[c].id}this.$subscribe(this.detail.template_message).then(function(){e.submit(n)}).catch(function(){e.submit(n)})}},get_token:function(e){var n=this;this.$request({url:this.$api.advance.pay_data,method:"post",data:c({},e)}).then(function(i){0===i.code?i.data.hasOwnProperty("id")?(t.hideLoading(),n.$payment.pay(i.data.id).then(function(){n.once_pay=!1,t.navigateTo({url:"/plugins/advance/order/order"})}).catch(function(){n.once_pay=!1,t.navigateTo({url:"/plugins/advance/order/order"})})):setTimeout(function(){n.get_token(e)},1e3):(t.hideLoading(),t.showToast({title:i.msg,icon:"none"}))})},get_submit:function(){var e=r(i.default.mark(function e(n){var o;return i.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$request({url:this.$api.advance.order_submit,method:"post",data:c({},n)});case 2:if(o=e.sent,0!==o.code){e.next=7;break}return e.abrupt("return",o);case 7:1===o.code&&t.showModal({title:"提示",content:o.msg,success:function(e){e.cancel?this.$emit("request",this.goods_id):e.confirm&&t.navigateBack()}});case 8:case"end":return e.stop()}},e,this)}));function n(t){return e.apply(this,arguments)}return n}(),getDate:function(t){var e=new Date(t.replace(/-/g,"/"));e.setDate(e.getDate());var n=e.getMonth()+1,i=e.getDate(),o="'"+n+"'",a="'"+i+"'";3==o.length&&(n="0"+n),3==a.length&&(i="0"+i);var r=e.getHours(),s=e.getMinutes(),c=e.getSeconds();return c="".concat(c),s="".concat(s),r="".concat(r),1===r.length&&(r="0".concat(r)),1===s.length&&(s="0".concat(s)),1===c.length&&(c="0".concat(c)),e.getFullYear()+"."+n+"."+i+" "+r+":"+s+":"+c}}};e.default=l}).call(this,n("543d")["default"])},c384:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=(t._self._c,t.getDate(t.end_prepayment_at)),i=t.getDate(t.end_prepayment_at);t.$mp.data=Object.assign({},{$root:{m0:n,m1:i}})},o=[];n.d(e,"a",function(){return i}),n.d(e,"b",function(){return o})},e6c3:function(t,e,n){"use strict";n.r(e);var i=n("c259"),o=n.n(i);for(var a in i)"default"!==a&&function(t){n.d(e,t,function(){return i[t]})}(a);e["default"]=o.a},f28a:function(t,e,n){"use strict";var i=n("b0b5"),o=n.n(i);o.a}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'plugins/advance/components/detail-bottom-button-create-component',
    {
        'plugins/advance/components/detail-bottom-button-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("5c91"))
        })
    },
    [['plugins/advance/components/detail-bottom-button-create-component']]
]);                
