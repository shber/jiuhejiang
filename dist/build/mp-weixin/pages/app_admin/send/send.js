(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/app_admin/send/send"],{"0823":function(e,i,t){"use strict";var s=function(){var e=this,i=e.$createElement;e._self._c},n=[];t.d(i,"a",function(){return s}),t.d(i,"b",function(){return n})},"1b3d":function(e,i,t){"use strict";t.r(i);var s=t("0823"),n=t("976a");for(var r in n)"default"!==r&&function(e){t.d(i,e,function(){return n[e]})}(r);t("54f9");var o=t("2877"),d=Object(o["a"])(n["default"],s["a"],s["b"],!1,null,"375cb772",null);i["default"]=d.exports},"54f9":function(e,i,t){"use strict";var s=t("7587"),n=t.n(s);n.a},7587:function(e,i,t){},"976a":function(e,i,t){"use strict";t.r(i);var s=t("f73c"),n=t.n(s);for(var r in s)"default"!==r&&function(e){t.d(i,e,function(){return s[e]})}(r);i["default"]=n.a},f73c:function(e,i,t){"use strict";(function(e){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var s=t("2f62");function n(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);i&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,s)}return t}function r(e){for(var i=1;i<arguments.length;i++){var t=null!=arguments[i]?arguments[i]:{};i%2?n(t,!0).forEach(function(i){o(e,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(t).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(t,i))})}return e}function o(e,i,t){return i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}var d={data:function(){return{express_no:"",express:"",customer_name:"",express_content:"",code:"",words:"",list:[],detail:{},dialog:!1,iphone_x:!1,id:"",chooseIndex:[0],express_id:0,newIndex:0,is_express:-2,is_send:0,order_refund_id:0,express_single:{},city:{cityList:[],deliveryId:null,delivery:"",cityServiceList:[],cityServiceId:null,cityService:"",isPreview:0,fee:0,name:"",delivery_no:""}}},computed:r({},(0,s.mapState)({userInfo:function(e){return e.user.info},adminImg:function(e){return e.mallConfig.__wxapp_img.app_admin}})),methods:{chooseAddress:function(e){if(this.is_send){var i=!0,t=!1,s=void 0;try{for(var n,r=this.detail.detailExpress[Symbol.iterator]();!(i=(n=r.next()).done);i=!0){var o=n.value;if(o.id==e.expressRelation.order_detail_express_id){this.express=o.express,this.is_express=2==o.send_type?0:1,this.express_content=o.express_content,this.express_no=o.express_no,this.express_id=o.id,this.customer_name=o.customer_name,this.code="",this.words=o.merchant_remark,this.code=o.code>0?o.code:"";var d=!0,a=!1,c=void 0;try{for(var l,h=this.detail.detail[Symbol.iterator]();!(d=(l=h.next()).done);d=!0){var u=l.value;u.choose=!1;var p=!0,_=!1,f=void 0;try{for(var x,y=o.expressRelation[Symbol.iterator]();!(p=(x=y.next()).done);p=!0){var v=x.value;v.order_detail_id==u.id&&(u.choose=!0)}}catch(m){_=!0,f=m}finally{try{p||null==y.return||y.return()}finally{if(_)throw f}}}}catch(m){a=!0,c=m}finally{try{d||null==h.return||h.return()}finally{if(a)throw c}}}}}catch(m){t=!0,s=m}finally{try{i||null==r.return||r.return()}finally{if(t)throw s}}}else e.choose=!e.choose;this.$forceUpdate()},toggleExpress:function(e){if(this.is_express=e,2==this.detail.send_type)for(var i in this.list=2==e?this.city.cityList:this.city.cityServiceList,this.list)2==this.is_express?this.list[i].id==this.city.deliveryId&&(this.chooseIndex[0]=+i,this.newIndex=+i):this.list[i].id==this.city.cityServiceId&&(this.chooseIndex[0]=+i,this.newIndex=+i)},bindChange:function(e){this.newIndex=e.detail.value[0]},toPick:function(e){var i=this;1==e?(i.customer_name="",i.newIndex=i.chooseIndex[0]):i.newIndex=i.chooseIndex[0],setTimeout(function(){i.dialog=!i.dialog})},closeDialog:function(e){1==e?(this.chooseIndex[0]=this.newIndex,2==this.detail.send_type?2==this.is_express?(this.city.delivery="("+this.list[this.chooseIndex[0]].id+")"+this.list[this.chooseIndex[0]].name,this.city.deliveryId=this.list[this.chooseIndex[0]].id):(this.city.cityService="("+this.list[this.chooseIndex[0]].id+")"+this.list[this.chooseIndex[0]].name,this.city.cityServiceId=this.list[this.chooseIndex[0]].id,this.city.isPreview=0):this.express=this.list[this.newIndex].name):this.newIndex=this.chooseIndex[0],this.dialog=!this.dialog},getExpressNo:function(){var i=this;e.showLoading({mask:!0,title:"加载中..."}),i.$request({url:i.$api.app_admin.print,data:{express:i.express,code:i.code,order_id:i.id,order_detail_ids:JSON.stringify(i.getIdList())}}).then(function(t){e.hideLoading(),0==t.code?(i.express_no=t.data.Order.LogisticCode,i.express_single=t.data.express_single):e.showToast({title:t.msg,icon:"none",duration:1e3})}).catch(function(i){e.hideLoading()})},getExpress:function(){var i=this;e.showLoading({mask:!0,title:"加载中..."}),i.$request({url:i.$api.app_admin.express}).then(function(t){e.hideLoading(),0==t.code?(i.list=t.data.list,i.getList()):e.showToast({title:t.msg,icon:"none",duration:1e3})}).catch(function(i){e.hideLoading()})},getList:function(){var i=this,t=this;e.showLoading({mask:!0,title:"加载中..."}),t.$request({url:t.$api.app_admin.detail,data:{order_id:t.id},method:"post"}).then(function(s){if(e.hideLoading(),0==s.code){for(var n in t.detail=s.data.order,2==i.detail.send_type?(t.getDelivery(),t.is_express=2):t.is_express=1,t.detail.detail)t.detail.detail[n].choose=!0;var r=t.is_send?1:0;for(var o in t.detail.detailExpress.length>r&&t.detail.detail.forEach(function(e){for(var i=r;i<t.detail.detailExpress.length;i++)for(var s in t.detail.detailExpress[i].expressRelation)t.detail.detailExpress[i].expressRelation[s].order_detail_id==e.id&&(e.choose=!t.is_send&&2)}),t.is_send>0?(t.express=s.data.order.detailExpress[0].express,t.is_express=2==s.data.order.detailExpress[0].send_type?0:1,t.express_content=s.data.order.detailExpress[0].express_content,t.express_no=s.data.order.detailExpress[0].express_no,t.express_id=s.data.order.detailExpress[0].id,t.customer_name=s.data.order.detailExpress[0].customer_name,t.code="",t.words=s.data.order.detailExpress[0].merchant_remark,s.data.order.code>0&&(t.code=s.data.order.detailExpress[0].code)):t.express=s.data.order.last_express?s.data.order.last_express:t.list[0].name,t.list)t.list[o].name==t.express&&(t.chooseIndex[0]=o)}else e.showToast({title:s.msg,icon:"none",duration:1e3})}).catch(function(i){e.hideLoading()})},saveAddress:function(i){var t=this;if(1!=t.is_express||t.express_no){var s=t.getIdList();if(0!=s.length||0!=t.order_refund_id){e.showLoading({mask:!0,title:"提交中..."});var n={is_express:1,order_id:t.id,express_no:t.express_no,express:t.express,code:t.code,customer_name:t.customer_name,merchant_remark:t.words,express_content:"",order_detail_id:JSON.stringify(s),express_single_id:t.express_single.id?t.express_single.id:0};0==t.is_express&&(n={is_express:2,order_id:t.id,express_content:t.express_content,order_detail_id:JSON.stringify(s)}),t.is_send>0&&(n.express_id=t.express_id),t.order_refund_id>0?t.$request({url:t.$api.app_admin.refund_handle,method:"POST",data:{is_express:1,type:2,is_agree:1,order_refund_id:t.order_refund_id,express_no:t.express_no,express:t.express,merchant_remark:t.words}}).then(function(i){if(e.hideLoading(),0==i.code){var t=i.msg;e.showToast({title:t,duration:1e3,icon:"success",mask:!1}),setTimeout(function(){e.navigateBack()},500)}else e.showToast({title:i.msg,icon:"none",duration:1e3})}).catch(function(i){e.hideLoading(),e.showToast({title:i,icon:"none",duration:1e3})}):t.$request({url:t.$api.app_admin.send,method:"POST",data:n}).then(function(i){if(e.hideLoading(),0==i.code){var s=i.msg;2==t.is_send&&(s="修改成功"),e.showToast({title:s,duration:1e3,icon:"success",mask:!1}),setTimeout(function(){e.navigateBack()},500)}else e.showToast({title:i.msg,icon:"none",duration:1e3})}).catch(function(i){e.hideLoading(),e.showToast({title:i,icon:"none",duration:1e3})})}else e.showToast({title:"请选择发货商品",icon:"none",duration:1e3})}else e.showToast({title:"快递单号不得为空",icon:"none",duration:1e3})},getIdList:function(){var e=this,i=[];for(var t in e.detail.detail)e.detail.detail[t].choose&&2!=e.detail.detail[t].choose&&i.push(e.detail.detail[t].id);return i},getDelivery:function(){var i=this,t=this;t.$request({url:t.$api.app_admin.delivery}).then(function(s){if(0===s.code){s.data.list.length>0&&(i.city.cityList=s.data.list,i.city.deliveryId=s.data.list[0].id,i.city.delivery="("+s.data.list[0].id+")"+s.data.list[0].name,i.list=i.city.cityList,i.is_express=2);var n=s.data.city_service_list;if(n.length>0){var r=[];n.forEach(function(e,i){"第三方"==e.service_type?r.push(e):"wxapp"==t.detail.platform&&"微信"==e.service_type&&r.push(e)}),i.city.cityServiceList=r,i.city.cityServiceId=r[0].id,i.city.cityService="("+r[0].id+")"+r[0].name}}else e.showToast({title:s.msg,icon:"none",duration:1e3})}).catch(function(i){e.hideLoading()})},citySend:function(){var i,t=this;if(2==t.detail.send_type){e.showLoading({mask:!0,title:"加载中..."});var s=t.getIdList();if(0==s.length&&0==t.order_refund_id)return void e.showToast({title:"请选择发货商品",icon:"none",duration:1e3});i={is_express:t.is_express,words:"",order_id:t.detail.id,order_detail_id:JSON.stringify(s),city_service:t.city.cityService,is_preview:t.city.isPreview?0:1,delivery_no:t.city.delivery_no},2==t.detail.send_type&&(i.man=t.city.delivery),t.is_send>0&&(i.express_id=t.express_id),t.$request({url:t.$api.app_admin.send,data:i,method:"post"}).then(function(i){if(e.hideLoading(),0===i.code){var s=i.data;s&&1==s.preview_success?(t.city.fee=s.fee,t.city.isPreview=1,t.city.name=s.name,t.city.isPreview=1,t.city.delivery_no=s.delivery_no):setTimeout(function(){e.navigateBack()},500),e.showToast({title:i.msg,type:"success",mask:!1,duration:2e3})}else e.showToast({title:i.msg,icon:"none",duration:1e3})}).catch(function(i){e.hideLoading(),e.showToast({title:i,icon:"none",duration:1e3})})}}},onLoad:function(i){this.$commonLoad.onload(i);var t=this;e.getSystemInfo({success:function(e){(e.model.indexOf("iPhone X")>-1||e.model.indexOf("iPhone 11")>-1||e.model.indexOf("iPhone11")>-1||e.model.indexOf("iPhone12")>-1||e.model.indexOf("Unknown Device")>-1)&&(t.iphone_x=!0)}}),i.id>0&&(t.id=i.id),i.order_refund_id>0&&(t.order_refund_id=i.order_refund_id),0==i.send_type?t.getExpress():(e.showLoading({mask:!0,title:"加载中..."}),t.getList()),i.is_send>0&&(t.is_send=i.is_send)}};i.default=d}).call(this,t("543d")["default"])}},[["20aa","common/runtime","common/vendor"]]]);